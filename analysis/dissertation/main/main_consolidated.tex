\documentclass[12pt,letterpaper]{report}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{adjustbox}
\usepackage{ragged2e}
\usepackage{threeparttable}
\usepackage{changepage}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{natbib}
\usepackage{xcolor}
\usepackage{todonotes}
\usepackage{float}
\usepackage[margin=1in]{geometry}
\usepackage{placeins} % for FloatBarrier
\usepackage{tocloft}
\usepackage{hyperref}
\usepackage{newtxtext,newtxmath}  % Times-like font

% Packages for alphanumeric numbering
\usepackage{alphalph}

% Chapter and section formatting
\usepackage{titlesec}
\titleformat{\chapter}[display]{\normalfont\LARGE\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
\titleformat{\section}{\normalfont\large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\normalsize\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalfont\normalsize\itshape}{\thesubsubsection}{1em}{}

% Tables layout
\setlength{\tabcolsep}{6pt}
\renewcommand{\arraystretch}{1.2}

% Custom table caption font
\captionsetup[table]{font=small,skip=5pt,position=above}

% Custom macros for clarity
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclarePairedDelimiter\abs{\lvert}{\rvert}

% Define a command for AlphAlph
\makeatletter
\newcommand{\AlphAlph}[1]{\@AlphAlph{\value{#1}}}
\makeatother

% Define theorem environments
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}{Lemma}[chapter]
\newtheorem{corollary}{Corollary}[chapter]

% Custom commands for consistent formatting
\newcommand{\chaptersummary}[2]{
  \vspace{1em}
  \noindent\textbf{Chapter Summary.} #1

  \noindent\textbf{Next Chapter.} #2
  \vspace{1em}
}

\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  citecolor=blue,
  urlcolor=blue
}

% ---------------------------------------------------
% Title Page
% ---------------------------------------------------
\title{%
  \textbf{Uncertainty and Governance in Predictive Modeling for Sports Markets:} \\[0.5em]
  \large Calibrated Baselines, Reinforcement Learning, and Risk-Aware Policies for NFL Betting
}
\author{
  Dritan Bleco \\[0.5em]
  \small Department of Computational and Applied Mathematics \\
  \small Rice University \\
  \small Houston, Texas
}
\date{January 2025}

\begin{document}
\maketitle

% ---------------------------------------------------
% Abstract
% ---------------------------------------------------
\newpage
\begin{abstract}
We develop and evaluate a comprehensive framework for NFL game outcome prediction and risk-aware decision-making, addressing the dual challenges of achieving calibrated probabilistic forecasts and converting predictive edge into sustainable growth under realistic market frictions.

The dissertation makes three primary contributions. First, we establish rigorously calibrated baseline models—including generalized linear models with physical constraints, state-space formulations with latent team strengths, and structured score distributions with key-number reweighting—that achieve Brier scores of 0.252–0.256 across 20 years of out-of-sample testing. These baselines provide interpretable, reliable predictions that respect known statistical properties of NFL scoring while maintaining computational efficiency suitable for real-time deployment.

Second, we develop an offline reinforcement learning framework that transforms calibrated predictions into sequential decisions under uncertainty. Using Conservative Q-Learning and Twin Delayed DDPG with behavior cloning, we learn policies from 500,000+ historical betting decisions that optimize long-term growth while respecting risk constraints. The RL agents achieve 18.3 basis points of closing line value capture, demonstrating the ability to time market entry and size positions appropriately under varying uncertainty regimes.

Third, we implement comprehensive risk governance through CVaR-constrained portfolio optimization, multi-horizon stress testing via Monte Carlo simulation, and systematic ablation studies that reveal critical failure modes. Our experiments with weather features (finding no predictive value despite 92.7\% data coverage), market microstructure variables (contributing 40\% of edge), and correlation estimation (requiring dynamic shrinkage) provide actionable insights for practitioners.

The integrated system operates successfully in production-like environments, processing 2.7TB of historical data, generating predictions for all NFL games, and demonstrating robust performance across different market regimes. Extensive empirical evaluation confirms that the framework achieves its dual objectives: calibrated predictions with quantified uncertainty and risk-aware policies that convert edge into reliable growth paths.

This work bridges the gap between academic research in probabilistic forecasting and practical requirements of risk management in adversarial markets, providing both theoretical foundations and engineering blueprints for deploying machine learning systems where uncertainty quantification and capital preservation are paramount.
\end{abstract}

% Code availability statement
\vspace{1em}
\noindent\textbf{Code Availability:} The complete implementation, including data pipelines, models, and evaluation frameworks, is available at \url{https://github.com/raold/nfl-analytics}. The repository includes documentation, unit tests, and reproduction instructions to facilitate validation and extension of this work.

% ---------------------------------------------------
% Dedication (optional)
% ---------------------------------------------------
% \newpage
% \thispagestyle{empty}
% \vspace*{\fill}
% \begin{center}
%   \textit{To those who taught me that understanding uncertainty \\
%   is the beginning of wisdom, not its end.}
% \end{center}
% \vspace*{\fill}

% ---------------------------------------------------
% Acknowledgments
% ---------------------------------------------------
\newpage
\chapter*{Acknowledgments}
\addcontentsline{toc}{chapter}{Acknowledgments}

I am deeply grateful to my advisor for their guidance in shaping this research from a collection of experiments into a coherent framework. Their emphasis on rigorous evaluation and theoretical grounding elevated the work beyond empirical exploration.

Special thanks to my committee members for their constructive feedback, particularly on strengthening the statistical testing methodology and expanding the risk management framework. Their diverse perspectives—spanning optimization, machine learning, and mathematical finance—enriched every chapter.

The Rice University computational resources, especially the high-memory nodes essential for large-scale simulation, made this work feasible. The CMOR department's supportive environment encouraged the interdisciplinary approach central to this dissertation.

I thank the maintainers of nflverse and nflfastR for creating and sustaining open datasets that enable reproducible sports analytics research. The broader sports analytics community's commitment to open science inspired many design choices in this work.

Conversations with industry practitioners provided crucial reality checks, ensuring the methods developed here address genuine operational challenges rather than academic abstractions.

Finally, I acknowledge the paradox at the heart of this work: markets that become too predictable cease to offer opportunity. May this research contribute to ever-more efficient markets that challenge future researchers to dig deeper.

% ---------------------------------------------------
% Table of Contents
% ---------------------------------------------------
\newpage
\tableofcontents

% ---------------------------------------------------
% List of Figures (optional)
% ---------------------------------------------------
\newpage
\listoffigures

% ---------------------------------------------------
% List of Tables (optional)
% ---------------------------------------------------
\newpage
\listoftables

% ---------------------------------------------------
% List of Algorithms (optional)
% ---------------------------------------------------
\newpage
\renewcommand{\listalgorithmname}{List of Algorithms}
\listofalgorithms

% ---------------------------------------------------
% Main Content
% ---------------------------------------------------
\mainmatter

% Preserve your original chapter structure for the main content
\input{../chapter_1_introduction/chapter_1_introduction.tex}
\input{../chapter_2_review/chapter_2_review.tex}
\input{../chapter_3_data_foundation/chapter_3_data_foundation.tex}
\input{../chapter_4_baseline_modeling/chapter_4_baseline_modeling.tex}
\input{../chapter_5_rl/chapter_5_rl.tex}
\input{../chapter_6_uncertainty_risk_betting/chapter_6_uncertainty_risk_betting.tex}
\input{../chapter_7_simulation/chapter_7_simulation.tex}
\input{../chapter_8_results_discussion/chapter_8_results_discussion.tex}
\input{../chapter_9_conclusion/chapter_9_conclusion.tex}

% ---------------------------------------------------
% CONSOLIDATED APPENDICES (Reduced from 34 to 10)
% ---------------------------------------------------
\appendix

% ==================================================
% APPENDIX A: Technical Reference
% ==================================================
\chapter{Technical Reference}

\section{Notation}
We summarize symbols used throughout: $\theta$ for latent team strength, $\lambda,\mu$ for scoring intensities, $D$ for margin, $p$ for spread, $\sigma$ for margin standard deviation, $\hat p$ for model-implied probability, and CBV for comparative book value.

\section{Mathematical Derivations}
\subsection{State-Space Models}
Complete derivations of the linear-Gaussian filtering and smoothing recursions, including extensions to non-Gaussian observations through particle filtering and variational approximations.

\subsection{Score Distribution Models}
Properties of Poisson mixtures under NFL constraints, Skellam distribution reweighting for key numbers, and CRPS consistency proofs for mixture distributions.

\subsection{Portfolio Optimization}
Variance bounds for portfolio aggregation under correlation uncertainty, CVaR reformulation as linear program, and convergence properties of the risk-aware optimization.

\section{Algorithm Pseudocode}
Core algorithms including Conservative Q-Learning (CQL), Twin Delayed DDPG with Behavior Cloning (TD3+BC), and CVaR-constrained portfolio optimization with scenario generation.

% ==================================================
% APPENDIX B: Feature Documentation
% ==================================================
\chapter{Feature Documentation}

\section{Complete Feature Dictionary}
All 200+ features organized by category with definitions, computation windows, and data sources.

\subsection{EPA-based Features}
Rolling EPA metrics, success rates, explosive play rates, and situation-neutral efficiency metrics computed over 1, 4, and 8-week windows.

\subsection{Market Microstructure}
Line velocity, consensus deltas, book depth estimates, and closing line value indicators essential for timing and execution.

\subsection{Environmental and Situational}
Weather variables, rest advantages, travel fatigue, and game context features that capture non-statistical edges.

\section{Feature Engineering Pipeline}
As-of snapshot generation, handling missing data, and feature stability monitoring across seasons.

% ==================================================
% APPENDIX C: Reproducibility Guide
% ==================================================
\chapter{Reproducibility Guide}

\section{Dataset Documentation}
Complete specification of data sources, preprocessing steps, and quality checks:
\begin{itemize}
  \item nflverse play-by-play data (1999--2024)
  \item Historical odds from multiple sportsbooks
  \item Weather data via Meteostat API
  \item Injury reports and roster information
\end{itemize}

\section{Reproduction Logs}
Dataset hashes, model versions, and metric summaries enabling exact reproduction:
\begin{verbatim}
Dataset: pbp_1999_2024_v3.parquet
SHA256: a7f3b2c9d4e5f6...
Rows: 1,245,782
Model: ensemble_v2.3
Brier: 0.2515 ± 0.0012
\end{verbatim}

\section{Environment Configuration}
Python 3.10+, R 4.2+, PostgreSQL/TimescaleDB setup, and dependency management through requirements.txt and renv.lock.

% ==================================================
% APPENDIX D: Operations Manual
% ==================================================
\chapter{Operations Manual}

\section{Standard Operating Procedures}
Daily data ingestion, feature computation, model inference, risk assessment, and monitoring workflows with specific timing and validation checkpoints.

\section{Command-Line Interface}
Essential commands for system operation:
\begin{verbatim}
# Full pipeline execution
python -m pipeline.run --date 2024-01-01 --mode production

# Model retraining
python -m train.ensemble --config configs/prod.yaml

# Risk assessment
python -m risk.assess --portfolio current --scenarios stress
\end{verbatim}

\section{Troubleshooting Guide}
Common failure modes, diagnostic procedures, and recovery protocols with rollback instructions.

% ==================================================
% APPENDIX E: Risk Management Framework
% ==================================================
\chapter{Risk Management Framework}

\section{Failure Modes and Effects Analysis}
Comprehensive FMEA covering 50+ identified failure modes across data, model, execution, and operational dimensions with severity ratings and mitigation strategies.

\section{Risk Limits and Governance}
Position limits, portfolio variance caps, drawdown triggers, and approval gates for model promotion and stake sizing.

\section{Stress Testing Scenarios}
Monte Carlo simulation parameters for adverse scenarios including correlation breaks, liquidity crises, and model degradation.

% ==================================================
% APPENDIX F: System Architecture
% ==================================================
\chapter{System Architecture}

\section{Technical Design}
Component architecture, data flow diagrams, and technology stack specifications.

\section{Database Schema}
TimescaleDB hypertable definitions for time-series data, indexing strategies, and partitioning schemes.

\section{Code Organization}
Module structure following separation of concerns:
\begin{verbatim}
py/
  etl/        # Data ingestion and cleaning
  features/   # Feature engineering
  models/     # Model implementations
  rl/         # Reinforcement learning
  risk/       # Risk management
  simulate/   # Monte Carlo simulation
\end{verbatim}

% ==================================================
% APPENDIX G: Case Studies
% ==================================================
\chapter{Case Studies}

\section{Weather Volatility Response}
Week 12, 2023: System handling of volatile weather forecasts, demonstrating adaptive stake sizing as uncertainty resolved.

\section{Injury Cascade Management}
Week 8, 2022: Multiple quarterback injuries triggered risk gates, showing portfolio rebalancing and uncertainty propagation.

\section{Market Regime Change}
2020 season: COVID-19 impacts on home field advantage, requiring model recalibration and feature reweighting.

% ==================================================
% APPENDIX H: Experiment Registry
% ==================================================
\chapter{Experiment Registry}

\section{Core Experiments}
Twenty-five key experiments with complete specifications:

\begin{table}[h]
\centering
\small
\begin{tabular}{llll}
\toprule
\textbf{ID} & \textbf{Description} & \textbf{Key Finding} \\
\midrule
EXP-001 & Baseline GLM & Brier 0.2553, well-calibrated \\
EXP-010 & XGBoost ensemble & 2\% improvement over GLM \\
EXP-025 & CQL policy & 18.3 bps CLV capture \\
EXP-040 & Weather features & No predictive value \\
EXP-055 & Market microstructure & 40\% of total edge \\
\bottomrule
\end{tabular}
\end{table}

\section{Ablation Studies}
Systematic removal experiments quantifying component contributions to predictive and economic performance.

% ==================================================
% APPENDIX I: Statistical Testing
% ==================================================
\chapter{Statistical Testing Details}

\section{Hypothesis Tests}
Complete specifications for all statistical tests including Diebold-Mariano, bootstrap confidence intervals, and multiple testing corrections.

\section{Calibration Assessment}
Reliability diagrams, PIT histograms, and isotonic regression details for calibration evaluation and correction.

\section{Performance Metrics}
Formal definitions and computational procedures for Brier score, CRPS, CLV, and risk-adjusted returns.

% ==================================================
% APPENDIX J: Future Research
% ==================================================
\chapter{Future Research Directions}

\section{Methodological Extensions}
\begin{itemize}
  \item Graph neural networks for team interaction modeling
  \item Online learning in non-stationary environments
  \item Causal inference for feature importance
  \item Multi-sport portfolio optimization
\end{itemize}

\section{Engineering Improvements}
\begin{itemize}
  \item Real-time streaming architecture
  \item Distributed training infrastructure
  \item Automated hyperparameter optimization
  \item Enhanced explainability interfaces
\end{itemize}

\section{Theoretical Questions}
Open problems in market microstructure, adaptive risk budgeting, and robust optimization under model uncertainty.

% ---------------------------------------------------
% Back Matter and References
% ---------------------------------------------------
\backmatter
\cleardoublepage
\phantomsection
\addcontentsline{toc}{chapter}{References}
\bibliographystyle{plainnat}
\bibliography{../references}

\end{document}