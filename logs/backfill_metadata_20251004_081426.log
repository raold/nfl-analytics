
Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

=== NFL Game Metadata Backfill ===

Adding metadata columns to games table...
NOTICE:  column "stadium" of relation "games" already exists, skipping

NOTICE:  column "roof" of relation "games" already exists, skipping

NOTICE:  column "surface" of relation "games" already exists, skipping

NOTICE:  column "temp" of relation "games" already exists, skipping

NOTICE:  column "wind" of relation "games" already exists, skipping

NOTICE:  column "away_rest" of relation "games" already exists, skipping

NOTICE:  column "home_rest" of relation "games" already exists, skipping

NOTICE:  column "away_qb_id" of relation "games" already exists, skipping

NOTICE:  column "home_qb_id" of relation "games" already exists, skipping

NOTICE:  column "away_qb_name" of relation "games" already exists, skipping

NOTICE:  column "home_qb_name" of relation "games" already exists, skipping

NOTICE:  column "away_coach" of relation "games" already exists, skipping

NOTICE:  column "home_coach" of relation "games" already exists, skipping

NOTICE:  column "referee" of relation "games" already exists, skipping

NOTICE:  column "stadium_id" of relation "games" already exists, skipping

NOTICE:  column "game_type" of relation "games" already exists, skipping

NOTICE:  column "overtime" of relation "games" already exists, skipping

NOTICE:  column "home_timeouts_remaining" of relation "games" already exists, skipping

NOTICE:  column "away_timeouts_remaining" of relation "games" already exists, skipping

NOTICE:  column "home_turnovers" of relation "games" already exists, skipping

NOTICE:  column "away_turnovers" of relation "games" already exists, skipping

NOTICE:  column "home_penalties" of relation "games" already exists, skipping

NOTICE:  column "away_penalties" of relation "games" already exists, skipping

NOTICE:  column "home_penalty_yards" of relation "games" already exists, skipping

NOTICE:  column "away_penalty_yards" of relation "games" already exists, skipping

NOTICE:  column "home_time_of_possession" of relation "games" already exists, skipping

NOTICE:  column "away_time_of_possession" of relation "games" already exists, skipping

✓ Added/verified 27 columns

Loading schedules from nflreadr...
Loaded 6991 games

Updating games with stadium and venue metadata...

1999 : Updated 259 games
2000 : Updated 259 games
2001 : Updated 259 games
2002 : Updated 267 games
2003 : Updated 267 games
2004 : Updated 267 games
2005 : Updated 267 games
2006 : Updated 267 games
2007 : Updated 267 games
2008 : Updated 267 games
2009 : Updated 267 games
2010 : Updated 267 games
2011 : Updated 267 games
2012 : Updated 267 games
2013 : Updated 267 games
2014 : Updated 267 games
2015 : Updated 267 games
2016 : Updated 267 games
2017 : Updated 267 games
2018 : Updated 267 games
2019 : Updated 267 games
2020 : Updated 269 games
2021 : Updated 285 games
2022 : Updated 284 games
2023 : Updated 285 games
2024 : Updated 285 games


Calculating game-level statistics from plays...
  Calculating turnovers...
[1] 6111
  Calculating penalties...
[1] 6057
✓ Calculated turnovers and penalties

=== Verification ===

Games by roof type:
      roof games  pct
1 outdoors  5140 73.5
2     dome  1144 16.4
3   closed   579  8.3
4     open   128  1.8

Games by surface:
      surface games  pct
1       grass  3888 55.6
2   fieldturf  1704 24.4
3   astroturf   476  6.8
4   sportturf   312  4.5
5  matrixturf   195  2.8
6   astroplay   118  1.7
7      a_turf   101  1.4
8      grass     93  1.3
9  dessograss    61  0.9
10               43  0.6

QB data coverage:
  total_games has_home_qb has_away_qb home_qb_pct away_qb_pct
1        6991        6991        6991         100         100

Turnover data (first 10 seasons):
   season games has_turnovers avg_turnovers_per_game
1    1999   210           210                   3.80
2    2000   210           210                   3.70
3    2001   208           208                   3.73
4    2002   220           220                   3.65
5    2003   220           220                   3.45
6    2004   218           218                   3.56
7    2005   221           221                   3.54
8    2006   222           222                   3.51
9    2007   218           218                   3.44
10   2008   219           219                   3.17

Sample enhanced game (2023 Super Bowl):
               [,1]               
game_id        "2023_22_SF_KC"    
matchup        "KC vs SF"         
stadium        "Allegiant Stadium"
roof           "dome"             
surface        "grass"            
temp           NA                 
wind           NA                 
home_qb_name   "Patrick Mahomes"  
away_qb_name   "Brock Purdy"      
home_coach     "Andy Reid"        
away_coach     "Kyle Shanahan"    
home_score     "25"               
away_score     "22"               
home_turnovers "3"                
away_turnovers "1"                

✅ Game metadata backfill complete!
Next steps:
  1. Refresh materialized views: SELECT mart.refresh_game_features();
  2. Update Python harness with new features
  3. Retrain models
